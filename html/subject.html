<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Materias</title>
      <link rel="stylesheet" href="../css/font-awesome.min.css">
      <link rel="stylesheet" href="../node_modules/bulma/css/bulma.css">
   </head>
   <body>
      <nav class="navbar" role="navigation" aria-label="main navigation">
         <div class="navbar-brand">
            <!-- navbar items, navbar burger... -->
            <a class="navbar-item" href="https://bulma.io">
            <img src="../images/letras.jpg" alt="Bulma: a modern CSS framework based on Flexbox" >
            </a> 
            <a class="navbar-item" href="index.html">
            Inicio
            </a>
            <a class="navbar-item" href="schedule.html">
            Horarios
            </a>
            <a class="navbar-item" href="teacher.html">
            Profesores
            </a>
            <a class="navbar-item" href="subject.html">
            Materias
            </a>
            <a class="navbar-item" href="classroom.html">
            Salones
            </a>
         </div>
         <div class="navbar-end">
            <!-- navbar items, navbar burger... -->
            <div class="navbar-item">
               <div class="field is-grouped">
                  <p class="control">
                     <a class="button is-danger" href="https://github.com/jgthms/bulma/releases/download/0.6.0/bulma-0.6.0.zip">
                     <span class="icon">
                     <i class="fa fa-ban"></i>
                     </span>
                     <span>Salir</span>
                     </a>
                  </p>
               </div>
            </div>
         </div>
      </nav>
      <section class="hero is-info">
         <div class="hero-body">
            <div class="container">
               <h1 class="title">
                  Administrar Materias
               </h1>
            </div>
         </div>
         <div class="tabs is-boxed">
            <ul>
               <li class="is-active"><a href="subject.html">Administar</a></li>
               <li><a href="createsubject.html">Crear</a></li>
            </ul>
         </div>
      </section>
      <br>
      <section id="app">
         <div class="container">
            <div class="field">
               <p class="control has-icons-left has-icons-right">
                  <input class="input" type="email" placeholder="Buscar">
                  <span class="icon is-small is-left">
                  <i class="fa fa-info-circle"></i>
                  </span>
               </p>
            </div>
            <table class="table table is-fullwidth table is-hoverable">
               <thead>
                  <tr>
                     <th>ID</th>
                     <th>Nombre</th>
                     <th>Semestre</th>
                     <th>Horas Practicas</th>
                     <th>Horas Teoricas</th>
                     <th></th>
                     <th></th>
                  </tr>
               </thead>
               <tbody id="content">
                  
                
               </tbody>
            </table>
         </div>
         <div id="delete" class="modal" >
          <div class="modal-background"></div>
          <div class="modal-card">
            <header class="modal-card-head">
              <p class="modal-card-title" id="text">Eliminar Materia </p>
              <button class="delete" aria-label="close" v-on:click="close()"></button>
            </header>
            <section class="modal-card-body">
              <h2>Seguro que desea eliminar?</h2>
            </section>
            <footer class="modal-card-foot">
              <button id="delete-btn" class="button is-success">Eliminar</button>
              <button  v-on:click="close()"  class="button" >Cancelar</button>
            </footer>
          </div>
        </div>

        <div class="modal" id="update">
            <div class="modal-background"></div>
            <div class="modal-card">
              <header class="modal-card-head">
                <p class="modal-card-title">Modal title</p>
                <button class="delete" v-on:click="cupdate()" aria-label="close"></button>
              </header>
              <section class="modal-card-body">
                <!-- Content ... -->
               
                    <div class="field">
                        <label class="label">Nombre</label>
                        <div class="control">
                            <input class="input" type="text" id="materia" placeholder="Nombre de la Materia">
                        </div>
                    </div>
               
              
                    <div class="field">
                        <label class="label">Semestre</label>
                        <div class="control">
                            <input class="input" type="number" id="semestre" min="1" placeholder="Semestre en el que se Impartirá">
                        </div>
                    </div>
                
                
                    <div class="field">
                        <label class="label">Horas Practicas</label>
                        <div class="control">
                            <input class="input" type="number" id="horap" min="1" placeholder="Hora en la que se Impartirá">
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Horas Teoricas</label>
                        <div class="control">
                            <input class="input" type="number" id="horat" min="1" placeholder="Hora en la que se Impartirá">
                        </div>
                    </div>
                
              </section>
              <footer class="modal-card-foot">
                <button class="button is-success" id="update-btn">Guardar cambios</button>
                <button  v-on:click="cupdate()" class="button">Cancel</button>
              </footer>
            </div>
          </div>
      </section>
      <script src="../node_modules/vue/dist/vue.js"></script>
<script>
   Vue.component('my-component', {
     template: '<div>A custom component!</div>',
     props:['salones']
   })
    var app = new Vue({
       el: '#app',
       data: {
         salones:[],
         msj:'hola'
       },methods:{
         close:function(){
           document.getElementById('delete').setAttribute("class", "modal")
       
           
           console.log(document.getElementById('text').removeChild(document.getElementById('text').lastChild))
         },cupdate:function(){
           document.getElementById('update').setAttribute("class", "modal")
      
           
    
         },
         del:function(id){
           console.log(id)
         },
         view:function(){
           var mysql = require('mysql')
           var connection = mysql.createConnection({
               host: 'localhost',
               user: 'root',
               password: '123',
               database: 'CECYTEM',
               port: 3306
           })
           var query2 = connection.query('SELECT * FROM TBL_MATERIA ', function(error, result){
               if(error){
                   throw error
               }else{
                   console.log(result)
                    result.forEach(function(element){
                        console.log(element)
                        let tr=document.createElement('tr')

                        let td=document.createElement('td')
                        td.appendChild(document.createTextNode(element['INT_MATERIA']))
                        tr.appendChild(td)
                        td=document.createElement('td')
                        td.appendChild(document.createTextNode(element['VCH_NOMBRE']))
                        tr.appendChild(td)

                        td=document.createElement('td')
                        td.appendChild(document.createTextNode(element['INT_SEMESTRE']))
                        tr.appendChild(td)

                        td=document.createElement('td')
                        td.appendChild(document.createTextNode(element['INT_HORAS_P']))
                        tr.appendChild(td)

                        td=document.createElement('td')
                        td.appendChild(document.createTextNode(element['INT_HORAS_T']))
                        tr.appendChild(td)


                          td=document.createElement('td')
                                let span=document.createElement('span')
                                let i=document.createElement('i')

                                i.setAttribute("class", "fa fa-ban")
                                span.appendChild(i)
                                span.setAttribute("class", "icon is-small")

                                let span2=document.createElement('span')
                                    span2.appendChild(span)
                                    span2.setAttribute("class", "button is-danger")
                                    span2.addEventListener("click",function(){
                                       p=document.createElement('p')
                                        p.appendChild(document.createTextNode(element['VCH_NOMBRE']))
                                        document.getElementById('delete').setAttribute("class", "is-active modal")
                                        document.getElementById('text').appendChild(p)
                                        document.getElementById('delete-btn').addEventListener("click",function(){
                                   
                                         this.removeEventListener('click', arguments.callee);
                                         document.getElementById('delete').setAttribute("class", "modal")
                                         var con = mysql.createConnection({
                                              host: 'localhost',
                                              user: 'root',
                                              password: '123',
                                              database: 'CECYTEM',
                                              port: 3306
                                          })
                                         var q = con.query('DELETE FROM TBL_MATERIA WHERE INT_MATERIA= ?',[element['INT_MATERIA']], function(error, result){
                                              if(error){
                                                 throw error;
                                              }else{
                                                  console.log("borrado")
                                              }
                                           });
                                          con.end();

                                      })

                                    })
                                  td.appendChild(span2)
                                  tr.appendChild(td)



                                td=document.createElement('td')
                                 span=document.createElement('span')
                                 i=document.createElement('i')

                                i.setAttribute("class", "fa fa-pencil")
                                span.appendChild(i)
                                span.setAttribute("class", "icon is-small")

                                 span2=document.createElement('span')
                                    span2.appendChild(span)
                                    span2.setAttribute("class", "button is-info")
                                    span2.addEventListener("click",function(){
                                      document.getElementById('update').setAttribute("class", "is-active modal")
                                      document.getElementById('materia').value=element['VCH_NOMBRE']
                                      document.getElementById('semestre').value=element['INT_SEMESTRE']
                                      document.getElementById('horap').value=element['INT_HORAS_P']
                                      document.getElementById('horat').value=element['INT_HORAS_T']
                                      document.getElementById('update-btn').addEventListener("click",function(){
                                        var con = mysql.createConnection({
                                              host: 'localhost',
                                              user: 'root',
                                              password: '123',
                                              database: 'CECYTEM',
                                              port: 3306
                                          })
                                         var q = con.query('UPDATE TBL_MATERIA SET VCH_NOMBRE= ?,INT_SEMESTRE=?,INT_HORAS_P=?,INT_HORAS_T=? WHERE INT_MATERIA= ?',[document.getElementById('materia').value,document.getElementById('semestre').value,document.getElementById('horap').value,document.getElementById('horat').value,element['INT_MATERIA']], function(error, result){
                                              if(error){
                                                 throw error;
                                              }else{
                                                  console.log("actualizado")
                                                   location.reload();
                                              }
                                           });
                                          con.end();
                                      })


                                    })
                                  td.appendChild(span2)
                                  tr.appendChild(td)


                        
                        document.getElementById('content').appendChild(tr)
                        console.log(tr)
                        })




   
                         
                    
               }
           });
          
           connection.end();
           
   
         }
       }
     })
     app.view()
   
   
   
</script>
   </body>
</html>