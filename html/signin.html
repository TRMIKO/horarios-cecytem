<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CECyTEM</title>
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" href="../node_modules/bulma/css/bulma.css">
    <link rel="stylesheet" href="../css/signin.css">
    <style>
        .separar {
            display: flex;
            justify-content: space-around;
        }
    </style>
</head>

<body>
    <div class="columns">
        <div class="column is-half is-offset-one-quarter">
            <img src="../asssets/image/logo.jpeg" alt="logo">
        </div>
    </div>
    <div class="columns">
        <div class="column is-half is-offset-one-quarter">
            <div class="field">
                <p class="control has-icons-left has-icons-right">
                    <input class="input" type="email" placeholder="Correo" id="email">
                    <span class="icon is-small is-left">
                        <i class="fa fa-user"></i>
                    </span>
                    <span class="icon is-small is-right">
                         <i class="fa fa-check"></i>
                    </span>
                </p>
            </div>
            <div class="field">
                <p class="control has-icons-left">
                    <input class="input" type="password" placeholder="ContraseÃ±a" id="password">
                    <span class="icon is-small is-left">
                        <i class="fa fa-lock"></i>
                    </span>
                </p>
            </div>
            <div class="field">
                <p class="control separar">
                    <a class="button is-link" href="#" onclick="Verificar()">
                        Entrar
                    </a>
                    <a class="button is-warning" href="signup.html">
                        Registro
                    </a>
                </p>
            </div>
        </div>
    </div>
    <script type="text/javascript">
       function Verificar () {
            var mysql = require('mysql');
            var connection = mysql.createConnection({
                host: 'localhost',
                user: 'CECYTEM',
                password: '100%CECYTEM',
                database: 'CECYTEM',
                port: 3306
            });
            var mail = document.getElementById("email").value;
            var pass = document.getElementById("password").value;
            connection.connect(function(error){
                if(error){
                    throw error;
                }else{
                    console.log('Conexion correcta.');
                }
            });
  
            var query2 = connection.query('SELECT VCH_CORREO, VCH_PASS, ENM_PERMISOS FROM TBL_USER WHERE VCH_CORREO=(?) AND VCH_PASS=(?) ', [mail, pass] , function(error, result){
                if(error){
                    throw error;
                }else{
                    var mail = document.getElementById("email").value;
                    var pass = document.getElementById("password").value;
                    if( result.length>0 && pass===result[0]['VCH_PASS'] && mail===result[0]['VCH_CORREO'] ) {
                        if( result[0]['ENM_PERMISOS']==="ADMIN" ) {
                                location.href="index.html";
                                alert("admin");
                           }
                        if( result[0]['ENM_PERMISOS']==="USER" ) {
                                //location.href="signup.html";
                                alert("usuario");
                           }
                    } else {
                        alert("Usuario o contrasena incorrecta.")
                    }
                }
            });
           
            connection.end();
            }
    </script>
</body>

</html>
